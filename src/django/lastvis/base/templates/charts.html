{% extends 'base.html' %}

{% block content %}
    <div class="container">
        <div class="row">
            <div class="span4">
                <h1>Welcome {{lastfmuser.user.username}}!</h1>
                <div class="control-group">
                    <label class="control-label" for="date-select">Select Chart Date</label>
                    <div class="controls">
                        <div id="date-select">
                            
                        </div>
                    </div>
                </div>
            </div>
            <div class="span8">
                <canvas data-processing-sources="{{STATIC_PATH}}processing/RGBCube.pde"></canvas>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
<script>

    $.getJSON('{{root_url}}api/weeklychartlist/', function(data) {
        var max = 0;
        var min = 9007199254740992;
        for(var i in data.charts) {
            if(data.charts[i].start < min) {
                min = data.charts[i].start; 
            }
            if(data.charts[i].end > max) {
                max = data.charts[i].end;
            }
        }
        max = parseInt(max) * 1000;
        min = parseInt(min) * 1000;
        alert(max);
        alert(min);
        $('#date-select').datepicker({
              dateFormat : "@",
              maxDate : max.toString(),
              minDate : min.toString(),
              onSelect : function(dateText, inst) {
                  alert(dateText);
                  var date = parseInt(dateText) / 1000;
                  alert(date);
                  for(var i in data.charts) {
                      if(date >= data.charts[i].start && date <= data.charts[i].end) {
                          alert(data.charts[i].start + ' ' + data.charts[i].end );
                      }
                  } 
              }
        });
    });
</script>
<script src="{{STATIC_PATH}}js/processing-1.3.6.js"></script>
{% endblock %}
