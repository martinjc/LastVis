{% extends 'base.html' %}

{% block content %}
    <div class="container">
        <div class="row">
            <div class="span4">
                <h1>Welcome {{lastfmuser.user.username}}!</h1>
            <div class="span8">
                <canvas id="viscanvas"></canvas>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
<script src="{{STATIC_PATH}}js/processing-1.3.6.js"></script>
<script>
    var printMessage = function(msg) {
        console.log(msg);
    }
    
    $(document).ready(function(){
        var canvas = document.getElementById('viscanvas');
        var pjs = new Processing(canvas);
        
        var value = 0;
        
        pjs.artist_data = {};
        pjs.setup = function() {
            pjs.size(800,800);
            pjs.noLoop();
            pjs.background(255);
            pjs.smooth();
            var chart_url = '{{root_url}}api/topartists/?callback=?';
            $.getJSON(chart_url, function(chart_data) {
                pjs.set_artist_data(chart_data);
                pjs.redraw();
            });            
        }
        
        pjs.set_artist_data = function(data) {
           this.artist_data = data;
        }
        
        pjs.draw = function() {
           var total_playcounts = [];
           var total_listeners = [];
           var user_listens = [];
           console.log(this.artist_data.artists);
           for(var i in this.artist_data.artists) {
               total_playcounts.push(this.artist_data.artists[i].total_playcount);
               total_listeners.push(this.artist_data.artists[i].total_listeners);
               user_listens.push(this.artist_data.artists[i].user_playcount);
               
           }
           var max_total_playcounts = pjs.max(total_playcounts);
           var min_total_playcounts = pjs.min(total_playcounts);
           var max_total_listeners =  pjs.max(total_listeners);
           var min_total_listeners = pjs.min(total_listeners);
           var max_user_listens = pjs.max(user_listens);
           var min_user_listens = pjs.min(user_listens);
           console.log( max_total_playcounts );
           console.log( min_total_playcounts );
           console.log( max_total_listeners );
           console.log( min_total_listeners );
           console.log( max_user_listens );
           console.log( min_user_listens );
           var x_pixels_per_play = 800/(max_total_playcounts-min_total_playcounts);
           var y_pixels_per_listener = 800/(max_total_listeners-min_total_listeners);
           console.log(x_pixels_per_play);
           console.log(y_pixels_per_listener);
           for(var i in this.artist_data.artists) {
               var x = x_pixels_per_play * this.artist_data.artists[i].total_playcount;
               var y = y_pixels_per_listener * this.artist_data.artists[i].total_listeners;
               console.log(x + ', ' + y);
               pjs.ellipse(x, y, 2, 2);
           }
           
        }
        
        pjs.mouseClicked = function() {
            pjs.redraw();
        }

        pjs.setup();

    });
</script>


{% endblock %}